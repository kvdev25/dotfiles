#! /usr/bin/env bash

# Get Image
tmp=$(mktemp)
yazi ~/Pictures/Wallpapers --chooser-file $tmp
image=$(cat $tmp)
[[ ! -f $image ]] && rm -f $tmp && exit
rm -f $tmp

# Get Theme
theme=$(basename $(dirname "$image"))

# Get Mode
mode=$(cat ~/.local/share/user/theme-details | rg mode | awk '{print $2}')
[[ $mode != "light" ]] && mode="dark"

# Apply
awww img "$image"
if [[ $theme = 'Wallpapers' ]]; then
  theme="dynamic"
  matugen -q -c ~/.config/matugen/matugen.toml image "$image"
fi
matugen json ~/.config/matugen/themes/${theme}.json

# Save Image and Mode
echo "image: $image" >~/.local/share/user/theme-details
echo "mode: $mode" >>~/.local/share/user/theme-details
echo "theme: $theme" >>~/.local/share/user/theme-details
