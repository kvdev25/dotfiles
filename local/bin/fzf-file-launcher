#! /usr/bin/env bash

if [[ -z "${IN_GHOSTTY_FLOAT:-}" ]]; then
  export IN_GHOSTTY_FLOAT=1
  exec open-ghostty -fs "$(realpath "$0")" "$@"
fi

file=$(fd -H . / | fzf --style=minimal)
[[ -f "$file" || -d "$file" ]] || exit

if xdg-mime query filetype "$file" | rg -q text; then
  hyprctl dispatch togglefloating
  uwsm app -- xdg-open $file
  exit
fi

setsid uwsm app -- xdg-open $file &
sleep 1
