#! /usr/bin/env bash

if [[ -z "${IN_GHOSTTY_FLOAT:-}" ]]; then
  export IN_GHOSTTY_FLOAT=1
  exec open-ghostty -f "$(realpath "$0")" "$@"
fi

theme=$(cat ~/.local/share/user/theme-details | rg theme | awk '{print $2}')
mode=$(cat ~/.local/share/user/theme-details | rg mode | awk '{print $2}')

# Get Image
tmp=$(mktemp)
yazi ~/Pictures/Wallpapers/$theme --chooser-file $tmp
image=$(cat "$tmp")
[[ ! -f $image ]] && rm -f "$tmp" && exit
rm -f "$tmp"

# Apply
swww img "$image"

# Save Image and Mode
echo "image: $image" >~/.local/share/user/theme-details
echo "mode: $mode" >>~/.local/share/user/theme-details
echo "theme: $theme" >>~/.local/share/user/theme-details
