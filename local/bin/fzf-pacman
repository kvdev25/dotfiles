#! /usr/bin/env bash

if [[ -z "${IN_GHOSTTY_FLOAT:-}" ]]; then
  export IN_GHOSTTY_FLOAT=1
  exec open-ghostty -f "$(realpath "$0")" "$@"
fi

source="pacman"
action="install"

for arg in "$@"; do
  case "$arg" in
  -aur) source="yay" ;;
  -S) action="install" ;;
  -R) action="remove" ;;
  *)
    echo "Specify '-S' to install or '-R' to remove"
    ;;
  esac
done

if [[ $action = "install" ]]; then
  if [[ $source = "yay" ]]; then
    $source -Slq |
      fzf --style=minimal --preview="$source -Si {1}" |
      xargs -ro $source -S
  else
    $source -Slq |
      fzf --style=minimal --preview="$source -Si {1}" |
      xargs -ro sudo $source -S
  fi

elif [[ $action == "remove" ]]; then
  pacman -Qeq |
    fzf --style=minimal --preview="pacman -Qi {1}" |
    xargs -ro sudo pacman -Rns
fi
